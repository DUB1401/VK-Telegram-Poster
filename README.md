# VK-Telegram Poster
**VK-Telegram Poster** – это инструмент автопостинга записей из сообщества ВКонтакте в каналы и группы Telegram с возможностью настройки пользовательского скрипта обработки постов. Для отправки сообщений используется буфер ожидания, что позволяет автопостеру корректно работать с включённым медленным режимом группы (чтобы игнорировать медленный режим или отправлять сообщения в канал, бот должен иметь права администратора).

## Порядок установки и использования
1. Загрузить последний релиз. Распаковать.
2. Установить Python версии не старше 3.10. Если основная версия Python вашего сервера ниже, указать целевую платформу путём редактирования первой строки в файле _vtp.py_ (_#!/usr/bin/python_ → _#!/usr/bin/python3.x_).
3. В среду исполнения установить следующие пакеты: [pyTelegramBotAPI](https://github.com/eternnoir/pyTelegramBotAPI), [fastapi](https://github.com/tiangolo/fastapi), [uvicorn](https://github.com/encode/uvicorn).
```
pip install pyTelegramBotAPI
pip install fastapi
pip install uvicorn
```
Либо установить сразу все пакеты при помощи следующей команды, выполненной из директории скрипта.
```
pip install -r requirements.txt
```
4. Настроить скрипт путём редактирования _Settings.json_. Для добавления пользовательского скрипта обработки постов можно внести изменения в файл _MessageEditor.py_.
5. При необходимости, например в случае использования скрипта на хостинге активного сайта, настроить переадресацию [nginx](https://nginx.org/) на свободный порт.
6. Провести валидацию сервера согласно данному [руководству](https://dev.vk.com/api/callback/getting-started#%D0%9F%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5%20Callback%20API). Код подтверждения перед верификацией занести в файл настроек _Settings.json_. По умолчанию скрипт слушает `{HOST}/vtp/vk-group-wall`.
7. Открыть директорию со скриптом в терминале. Можно использовать метод `cd` и прописать путь к папке, либо запустить терминал из проводника. Активировать автопостер командой `uvicorn vtp:App --host {IP} --port {PORT}`.
8. Для автоматического запуска службы рекомендуется провести инициализацию скрипта через [systemd](https://github.com/systemd/systemd) (пример [здесь](https://github.com/DUB1401/VK-Telegram-Poster/tree/main/systemd)) на Linux или путём добавления его в автозагрузку на Windows.

# Settings.json
```JSON
"token": ""
```
Сюда необходимо занести токен бота Telegram (можно узнать у [@BotFather](https://t.me/BotFather)).
___
```JSON
"target-id": ""
```
Сюда необходимо занести  ID группы или канала Telegram (можно получить у [Chat ID Bot](https://t.me/chat_id_echo_bot)).
___
```JSON
"source": "vk-group-wall"
```
Указывает конечную часть URI, использующегося для прослушивания Callback-запросов. По умолчанию скрипт слушает `{HOST}/vtp/vk-group-wall`.
___
```JSON
"clean-tags": true
```
Если включено, скрипт будет удалять упоминания из тегов ВКонтакте (_#tag@mention_ → _#tag_). Рекомендуется к активации, так как Telegram не поддерживает подобный формат.
___
```JSON
"parse-mode": null
```
Указывает способ форматирования сообщения, отправляемого в группу Telegram. 

Поддерживаются: _MarkdownV2_, _HTML_.
___
```JSON
"disable-web-page-preview": true
```
Если включено, ссылки из сообщения, в том числе форматированные, не будут отображаться в предпросмотре под данным сообщением.
___
```JSON
"blacklist": []
```
Здесь можно перечислить запрещённые слова, при наличии которых пост будет игнорироваться. Настройка нечувствительна к регистру.
___
```JSON
"confirmation-code": ""
```
Указывает код подтверждения, необходимый для валидации прослушивающего сервера.

> **Warning**
> Код подтверждения периодически меняется. Убедитесь, что вы используете верную комбинацию.
___
```JSON
"logging": false
```
Если включено, скрипт будет вести логи инициализации и прослушивания запросов.
___
```JSON
"debug": false
```
Включает отладочный режим логгирования.

_Copyright © DUB1401. 2022-2023._
